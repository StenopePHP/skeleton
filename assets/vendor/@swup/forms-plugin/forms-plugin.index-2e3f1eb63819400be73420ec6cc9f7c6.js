/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@swup/forms-plugin@3.5.1/dist/index.modern.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"@swup/plugin";import{getCurrentUrl as e,Location as r}from"swup";function s(){return s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},s.apply(this,arguments)}class o extends t{constructor(t={}){super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]",stripEmptyParams:!1},this.options=void 0,this.specialKeys={Meta:!1,Control:!1,Shift:!1},this.formSubmitDelegate=void 0,this.onBlur=()=>{this.resetSpecialKeys()},this.onKeyDown=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!0)},this.onKeyUp=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!1)},this.handleInlineForms=t=>{const{el:e}=t.trigger;if(null==e||!e.matches(this.options.inlineFormSelector))return;if(!e.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",e);const r=`#${e.id}`;t.containers=[r],t.animation.scope="containers",t.animation.selector=r,t.scroll.target=r;const s=t.a11y;"object"==typeof s&&(s.focus=r)},this.options=s({},this.defaults,t)}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),this.on("visit:start",this.handleInlineForms,{priority:1}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unmount(){var t;null==(t=this.formSubmitDelegate)||t.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur)}beforeFormSubmit(t){const s=this.swup,{delegateTarget:o,submitter:i}=t,n=this.getFormAttr("action",o,i)||e(),a=this.isSpecialKeyPressed(),m="_blank"===this.getFormAttr("target",o,i),l=a||m,{url:u,hash:h}=r.fromUrl(n),p=s.createVisit({to:u,hash:h,el:o,event:t});if(l||!s.shouldIgnoreVisit(n,{el:o,event:t})){if(!m)return a?(s.hooks.callSync("form:submit:newtab",p,{el:o,event:t}),o.dataset.swupOriginalFormTarget=o.getAttribute("target")||"",o.setAttribute("target","_blank"),void o.addEventListener("submit",(()=>requestAnimationFrame((()=>this.restorePreviousFormTarget(o)))),{once:!0})):void s.hooks.callSync("form:submit",p,{el:o,event:t},(()=>{this.submitForm(t)}));s.hooks.callSync("form:submit:newtab",p,{el:o,event:t})}}restorePreviousFormTarget(t){t.dataset.swupOriginalFormTarget?t.setAttribute("target",t.dataset.swupOriginalFormTarget):t.removeAttribute("target")}submitForm(t){const e=t.delegateTarget,{url:r,hash:s,method:o,data:i,body:n}=this.getFormInfo(e,t);let a=r,m={method:o};switch(o){case"POST":m={method:o,body:n};break;case"GET":this.maybeStripEmptyParams(i),a=this.appendQueryParams(a,i);break;default:return void console.warn(`Unsupported form method: ${o}`)}t.preventDefault(),this.swup.cache.delete(a),this.swup.navigate(a+s,m,{el:e,event:t})}getFormInfo(t,{submitter:s}){const o=(this.getFormAttr("method",t,s)||"get").toUpperCase(),i=this.getFormAttr("action",t,s)||e(),{url:n,hash:a}=r.fromUrl(i),m=(this.getFormAttr("enctype",t,s)||"application/x-www-form-urlencoded").toLowerCase(),l="multipart/form-data"===m,u=new FormData(t);let h;return h=l?u:new URLSearchParams(u),{url:n,hash:a,method:o,data:u,body:h,encoding:m}}getFormAttr(t,e,r=null){var s;return null!=(s=null==r?void 0:r.getAttribute(`form${t}`))?s:e.getAttribute(t)}appendQueryParams(t,e){const r=t.split("?")[0],s=new URLSearchParams(e).toString();return s?`${r}?${s}`:r}maybeStripEmptyParams(t){if(this.options.stripEmptyParams)for(const[e,r]of Array.from(t.entries()))""===r&&t.delete(e)}isSpecialKeyPressed(){return Object.values(this.specialKeys).some((t=>t))}resetSpecialKeys(){for(const t of Object.keys(this.specialKeys))this.specialKeys[t]=!1}}export{o as default};
